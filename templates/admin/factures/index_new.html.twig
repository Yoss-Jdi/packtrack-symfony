{% extends 'admin/base.html.twig' %}

{% block title %}Factures{% endblock %}

{% block body %}
<div style="background: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">

    <h1 style="margin-bottom: 20px; color: #333;">Liste des factures</h1>

    <form method="get" action="{{ path('app_facture_index') }}" style="margin-bottom: 20px; text-align: right;">
        <input
            type="text"
            id="searchNumero"
            name="numero"
            placeholder="Rechercher par numéro"
            value="{{ searchNumero|default('') }}"
            style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; width: 220px;"
        >
        <button
            type="submit"
            style="padding: 8px 15px; border-radius: 5px; background-color: #0d6efd; color: white; border: none; cursor: pointer;"
        >
            Rechercher
        </button>

        {% if searchNumero %}
            <a href="{{ path('app_facture_index') }}" style="margin-left: 10px; color: #666; text-decoration: none;">
                Annuler
            </a>
        {% endif %}
    </form>

    <table id="factureTable" style="width:100%; border-collapse: collapse;">
        <thead style="background-color: #f8f9fa;">
            <tr>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">ID</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Numéro</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Date d'émission</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Montant HT</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Montant TTC</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">TVA</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Statut</th>
                <th style="padding: 10px; border-bottom: 1px solid #dee2e6;">Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for facture in factures %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">{{ facture.id }}</td>
                    <td class="numero" style="padding: 10px;">{{ facture.numero }}</td>
                    <td style="padding: 10px;">
                        {{ facture.dateEmission ? facture.dateEmission|date('Y-m-d H:i') : '' }}
                    </td>
                    <td style="padding: 10px;">{{ facture.montantHT }}</td>
                    <td style="padding: 10px;">{{ facture.montantTTC }}</td>
                    <td style="padding: 10px;">{{ facture.tva }}</td>
                    <td style="padding: 10px;">{{ facture.statut }}</td>
                    <td style="padding: 10px; white-space: nowrap;">
                        <a href="{{ path('app_facture_edit', {'id': facture.id}) }}" style="margin-right: 8px;">Modifier</a>
                        <a href="{{ path('app_facture_pdf', {'id': facture.id}) }}" style="margin-right: 8px;">PDF</a>

                        <form
                            method="post"
                            action="{{ path('app_facture_delete', {'id': facture.id}) }}"
                            style="display:inline-block;"
                            onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette facture ?');"
                        >
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ facture.id) }}">
                            <button
                                type="submit"
                                style="background:#e9ecef; color:#333; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;"
                            >
                                Supprimer
                            </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" style="padding: 15px; text-align: center; color: #777;">
                        Aucune facture trouvée
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <a
        href="{{ path('app_facture_new') }}"
        style="display:inline-block; margin-top: 20px; padding: 8px 15px; background:#198754; color:white; border-radius:5px; text-decoration:none;"
    >
        Créer une nouvelle facture
    </a>

</div>
{% endblock %}

{% block javascripts %}
<script>
    const searchInput = document.getElementById('searchNumero');
    const table = document.getElementById('factureTable');
    const rows = table.querySelectorAll('tbody tr');

    searchInput.addEventListener('input', function () {
        const filter = this.value.toLowerCase();
        rows.forEach(row => {
            const numeroCell = row.querySelector('.numero');
            if (numeroCell) {
                const text = numeroCell.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            }
        });
    });
</script>
{% endblock %}
