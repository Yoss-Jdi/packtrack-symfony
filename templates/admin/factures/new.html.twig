{% extends 'admin/base.html.twig' %}

{% block title %}Nouvelle facture{% endblock %}



{% block body %}

<div style="background:#ffffff; min-height:100vh; padding-top:30px;">


<div style="position: relative; z-index: 10;">

<h1 style="text-align:center; margin-bottom:30px;">
    Créer une nouvelle facture
</h1>
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div style="padding:10px; margin-bottom:15px; border-radius:5px; background: {% if label == 'error' %}#f8d7da{% else %}#d1e7dd{% endif %}; color: {% if label == 'error' %}#842029{% else %}#0f5132{% endif %};">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}
<div style="padding:20px; max-width:600px; margin:20px auto; background:#ffffff; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.05);">
    {{ form_start(form) }}

        <div style="display:grid; grid-template-columns:150px 1fr; gap:15px; align-items:center;">

            {{ form_label(form.numero) }}
            {{ form_widget(form.numero, {'attr': {'class':'input-field'}}) }}

            {{ form_label(form.dateEmission) }}
            {{ form_widget(form.dateEmission, {'attr': {'class':'input-field'}}) }}

            {{ form_label(form.montantHT) }}
            {{ form_widget(form.montantHT, {
                'attr': {
                    'class':'input-field',
                    'id': form.montantHT.vars.id
                }
            }) }}

            <label for="tva">TVA (20%)</label>
            <input type="text" id="tva" class="input-field" readonly
                   style="padding:8px; border-radius:5px; border:1px solid #e0e0e0; background:#f8f9fa;">

            <label for="montantTTC">Montant TTC</label>
            <input type="text" id="montantTTC" class="input-field" readonly
                   style="padding:8px; border-radius:5px; border:1px solid #e0e0e0; background:#f8f9fa;">
        </div>

        <div style="margin-top:20px; text-align:right;">
            <button type="submit"
                    style="padding:8px 20px; border-radius:5px; background:#0d6efd; color:white; border:none; cursor:pointer;">
                Enregistrer
            </button>

            <a href="{{ path('app_facture_index') }}"
               style="margin-left:10px; text-decoration:none; color:#555; cursor:pointer;">
                ← Retour à la liste
            </a>
        </div>

    {{ form_end(form) }}
</div>

</div>

{% endblock %}

{% block javascripts %}
<script>
    const montantHTInput = document.getElementById('{{ form.montantHT.vars.id }}');
    const tvaInput = document.getElementById('tva');
    const ttcInput = document.getElementById('montantTTC');

    if (montantHTInput && tvaInput && ttcInput) {
        function calculer() {
            const ht = parseFloat(montantHTInput.value);
            if (!isNaN(ht)) {
                const tva = ht * 0.20;
                const ttc = ht * 1.20;
                tvaInput.value = tva.toFixed(2);
                ttcInput.value = ttc.toFixed(2);
            } else {
                tvaInput.value = '';
                ttcInput.value = '';
            }
        }

        // Initialise si valeur déjà présente
        calculer();

        // Recalcul automatique au changement de Montant HT
        montantHTInput.addEventListener('input', calculer);
    }
</script>
</div>
{% endblock %}
