{% extends 'admin/base.html.twig' %}

{% block title %}Créer un utilisateur - PackTrack{% endblock %}

{% block body %}
    {# TOPBAR #}
    <div class="topbar">
        <input type="text" placeholder="Rechercher un utilisateur...">
        <div class="user">
            <img src="https://i.pravatar.cc/40?img=12" alt="Admin">
            <span>Admin</span>
        </div>
    </div>

    {# FORMULAIRE DE CREATION UTILISATEUR #}
    <section class="table-section" style="margin-top:25px;">
        <h3>Créer un nouvel utilisateur</h3>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">Créer un nouvel utilisateur</h3>
                    </div>
                    <div class="card-body">
                        {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

                        {# Email #}
                        <div class="mb-3">
                            {{ form_label(form.Email, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.Email, {
                                'attr': {
                                    'class': 'form-control' ~ (submitted and form.Email.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.Email.vars.errors|length == 0 ? ' is-valid' : ''))
                                }
                            }) }}
                            {% if submitted %}
                                {% if form.Email.vars.errors|length == 0 %}
                                    <div class="valid-feedback d-block mt-1">✓ Email valide</div>
                                {% else %}
                                    <div class="invalid-feedback d-block mt-1">{{ form_errors(form.Email) }}</div>
                                {% endif %}
                            {% endif %}
                        </div>

                        {# Mot de passe #}
                        <div class="mb-3">
                            {{ form_label(form.plainPassword, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.plainPassword, {
                                'attr': {
                                    'class': 'form-control' ~ (submitted and form.plainPassword.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.plainPassword.vars.errors|length == 0 ? ' is-valid' : ''))
                                }
                            }) }}
                            {% if submitted %}
                                {% if form.plainPassword.vars.errors|length == 0 %}
                                    <div class="valid-feedback d-block mt-1">✓ Mot de passe valide</div>
                                {% else %}
                                    <div class="invalid-feedback d-block mt-1">{{ form_errors(form.plainPassword) }}</div>
                                {% endif %}
                            {% endif %}
                        </div>

                        {# Nom et Prénom #}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form_label(form.Nom, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                                {{ form_widget(form.Nom, {
                                    'attr': {
                                        'class': 'form-control' ~ (submitted and form.Nom.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.Nom.vars.errors|length == 0 ? ' is-valid' : ''))
                                    }
                                }) }}
                                {% if submitted %}
                                    {% if form.Nom.vars.errors|length == 0 %}
                                        <div class="valid-feedback d-block mt-1">✓ Nom valide</div>
                                    {% else %}
                                        <div class="invalid-feedback d-block mt-1">{{ form_errors(form.Nom) }}</div>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form_label(form.Prenom, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                                {{ form_widget(form.Prenom, {
                                    'attr': {
                                        'class': 'form-control' ~ (submitted and form.Prenom.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.Prenom.vars.errors|length == 0 ? ' is-valid' : ''))
                                    }
                                }) }}
                                {% if submitted %}
                                    {% if form.Prenom.vars.errors|length == 0 %}
                                        <div class="valid-feedback d-block mt-1">✓ Prénom valide</div>
                                    {% else %}
                                        <div class="invalid-feedback d-block mt-1">{{ form_errors(form.Prenom) }}</div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>

                        {# Téléphone #}
                        <div class="mb-3">
                            {{ form_label(form.Telephone, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.Telephone, {
                                'attr': {
                                    'class': 'form-control' ~ (submitted and form.Telephone.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.Telephone.vars.errors|length == 0 ? ' is-valid' : ''))
                                }
                            }) }}
                            {% if submitted %}
                                {% if form.Telephone.vars.errors|length == 0 %}
                                    <div class="valid-feedback d-block mt-1">✓ Téléphone valide</div>
                                {% else %}
                                    <div class="invalid-feedback d-block mt-1">{{ form_errors(form.Telephone) }}</div>
                                {% endif %}
                            {% endif %}
                        </div>

                        {# Rôle #}
                        <div class="mb-3">
                            {{ form_label(form.role, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.role, {
                                'attr': {
                                    'class': 'form-select' ~ (submitted and form.role.vars.errors|length > 0 ? ' is-invalid' : (submitted and form.role.vars.errors|length == 0 ? ' is-valid' : ''))
                                }
                            }) }}
                            {% if submitted %}
                                {% if form.role.vars.errors|length == 0 %}
                                    <div class="valid-feedback d-block mt-1">✓ Rôle sélectionné</div>
                                {% else %}
                                    <div class="invalid-feedback d-block mt-1">{{ form_errors(form.role) }}</div>
                                {% endif %}
                            {% endif %}
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a href="{{ path('app_utilisateurs') }}" class="btn btn-secondary me-2">Annuler</a>
                            <button type="submit" class="btn btn-success">Créer l'utilisateur</button>
                        </div>

                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div>
    </section>

    {# STYLE VALIDATION #}
    <style>
        .valid-feedback { font-size: 0.875rem; font-weight: 500; color: #198754 !important; padding-left: 5px; }
        .invalid-feedback { font-size: 0.875rem; font-weight: 500; color: #dc3545 !important; padding-left: 5px; }
        .form-text { font-size: 0.875rem; color: #6c757d !important; padding-left: 5px; }
        .invalid-feedback ul { list-style-type: none; padding-left: 0; margin-bottom: 0; }
        .form-control.is-valid, .form-select.is-valid {
            border-color: #198754 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        }
        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        }
        .form-control.is-valid:focus { border-color: #198754; box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25); }
        .form-control.is-invalid:focus { border-color: #dc3545; box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25); }
        .is-invalid ~ .form-text { display: none; }
    </style>
{% endblock %}
