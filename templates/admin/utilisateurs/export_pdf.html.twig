<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste des Utilisateurs ‚Äî PackTrack</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f4f6f9;
            color: #2c3e50;
            padding: 0;
        }

        /* === En-t√™te === */
        .pdf-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 2.5rem 3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pdf-header .logo-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .pdf-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .pdf-header .subtitle {
            font-size: 0.95rem;
            opacity: 0.85;
        }

        .pdf-meta {
            text-align: right;
            font-size: 0.88rem;
            opacity: 0.9;
        }

        .pdf-meta strong {
            display: block;
            font-size: 1rem;
        }

        /* === Stats band === */
        .stats-band {
            background: white;
            padding: 1.5rem 3rem;
            display: flex;
            gap: 2rem;
            border-bottom: 3px solid #e0e6ed;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .stat-icon.blue   { background: linear-gradient(135deg, #3498db, #2980b9); }
        .stat-icon.red    { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .stat-icon.green  { background: linear-gradient(135deg, #27ae60, #1e8449); }
        .stat-icon.orange { background: linear-gradient(135deg, #f39c12, #d68910); }

        .stat-text .stat-num  { font-size: 1.4rem; font-weight: 700; color: #2c3e50; }
        .stat-text .stat-lbl  { font-size: 0.78rem; color: #7f8c8d; text-transform: uppercase; }

        /* === Table === */
        .table-wrapper {
            padding: 2rem 3rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        thead th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 1rem 1.2rem;
            font-size: 0.82rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: left;
        }

        tbody tr { border-bottom: 1px solid #f0f3f7; }
        tbody tr:last-child { border-bottom: none; }
        tbody tr:nth-child(even) { background: #f8fafc; }
        tbody tr:nth-child(odd)  { background: white; }

        tbody td {
            padding: 0.9rem 1.2rem;
            font-size: 0.9rem;
            vertical-align: middle;
        }

        .badge-avatar {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            margin-right: 0.6rem;
            vertical-align: middle;
        }

        .role-pill {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .role-pill.admin        { background: #fde8e8; color: #c0392b; }
        .role-pill.gestionnaire { background: #fef3cd; color: #d68910; }
        .role-pill.livreur      { background: #d5f5e3; color: #1e8449; }
        .role-pill.client       { background: #d6eaf8; color: #2980b9; }

        .id-pill {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.2rem 0.7rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.82rem;
        }

        /* === Footer === */
        .pdf-footer {
            background: #2c3e50;
            color: rgba(255,255,255,0.7);
            text-align: center;
            padding: 1.2rem;
            font-size: 0.82rem;
            margin-top: 2rem;
        }

        .pdf-footer strong { color: white; }

        /* === Print button === */
        .print-bar {
            background: white;
            padding: 1rem 3rem;
            border-bottom: 2px solid #e0e6ed;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn-print {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.92rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-back-link {
            background: #ecf0f1;
            color: #2c3e50;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.92rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        @media print {
            .print-bar { display: none !important; }
            body { background: white; }
        }
    </style>
</head>
<body>

    {# Barre d'actions (masqu√©e √† l'impression) #}
    <div class="print-bar">
        <a href="{{ path('app_utilisateurs') }}" class="btn-back-link">
            ‚Üê Retour √† la liste
        </a>
        <button onclick="window.print()" class="btn-print">
            üñ®Ô∏è Imprimer / Sauvegarder en PDF
        </button>
    </div>

    {# En-t√™te #}
    <div class="pdf-header">
        <div class="logo-area">
            <div class="logo-icon">üì¶</div>
            <div>
                <h1>PackTrack</h1>
                <div class="subtitle">Liste des Utilisateurs</div>
            </div>
        </div>
        <div class="pdf-meta">
            <strong>Rapport g√©n√©r√© le</strong>
            {{ date|date('d/m/Y √† H:i') }}
        </div>
    </div>

    {# Statistiques rapides #}
    {% set total = utilisateurs|length %}
    {% set nb_admin = 0 %}
    {% set nb_client = 0 %}
    {% set nb_livreur = 0 %}
    {% set nb_gestionnaire = 0 %}
    {% for u in utilisateurs %}
        {% if u.role.value == 'ADMIN' %}{% set nb_admin = nb_admin + 1 %}{% endif %}
        {% if u.role.value == 'CLIENT' %}{% set nb_client = nb_client + 1 %}{% endif %}
        {% if u.role.value == 'LIVREUR' %}{% set nb_livreur = nb_livreur + 1 %}{% endif %}
        {% if u.role.value == 'GESTIONNAIRE' %}{% set nb_gestionnaire = nb_gestionnaire + 1 %}{% endif %}
    {% endfor %}

    <div class="stats-band">
        <div class="stat-item">
            <div class="stat-icon blue">üë•</div>
            <div class="stat-text">
                <div class="stat-num">{{ total }}</div>
                <div class="stat-lbl">Total</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon red">üõ°Ô∏è</div>
            <div class="stat-text">
                <div class="stat-num">{{ nb_admin }}</div>
                <div class="stat-lbl">Admins</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon green">üöö</div>
            <div class="stat-text">
                <div class="stat-num">{{ nb_livreur }}</div>
                <div class="stat-lbl">Livreurs</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon orange">üëî</div>
            <div class="stat-text">
                <div class="stat-num">{{ nb_gestionnaire }}</div>
                <div class="stat-lbl">Gestionnaires</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon blue">üë§</div>
            <div class="stat-text">
                <div class="stat-num">{{ nb_client }}</div>
                <div class="stat-lbl">Clients</div>
            </div>
        </div>
    </div>

    {# Tableau #}
    <div class="table-wrapper">
        <div class="section-title">üìã Tous les utilisateurs ({{ total }})</div>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Utilisateur</th>
                    <th>Email</th>
                    <th>T√©l√©phone</th>
                    <th>R√¥le</th>
                    <th>Membre depuis</th>
                </tr>
            </thead>
            <tbody>
                {% for utilisateur in utilisateurs %}
                    <tr>
                        <td><span class="id-pill">#{{ utilisateur.id }}</span></td>
                        <td>
                            <span class="badge-avatar">
                                {{ utilisateur.prenom|slice(0,1)|upper }}{{ utilisateur.nom|slice(0,1)|upper }}
                            </span>
                            {{ utilisateur.prenom }} {{ utilisateur.nom }}
                        </td>
                        <td>{{ utilisateur.email }}</td>
                        <td>{{ utilisateur.telephone ?? '‚Äî' }}</td>
                        <td>
                            <span class="role-pill {{ utilisateur.role.value|lower }}">
                                {{ utilisateur.role.value }}
                            </span>
                        </td>
                        <td>{{ utilisateur.createdAt|date('d/m/Y') }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="pdf-footer">
        <strong>PackTrack</strong> ‚Äî Document confidentiel ¬∑ G√©n√©r√© automatiquement le {{ date|date('d/m/Y √† H:i') }}
    </div>

</body>
</html>
