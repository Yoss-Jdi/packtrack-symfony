<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PackTrack - Admin{% endblock %}</title>
    
    {# CSS du backoffice #}
    <link rel="stylesheet" href="{{ asset('css/back-style.css') }}">
    
    {# Font Awesome #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    {% block stylesheets %}{% endblock %}
</head>
<body>
    <div class="layout">
        {# SIDEBAR #}
        <aside class="sidebar">
            <h2>ðŸ“¦ PackTrack</h2>
            <ul>
                <li class="{{ app.request.get('_route') == 'admin_dashboard' ? 'active' }}">
                    <a href="{{ path('admin_dashboard') }}">
                        <i class="fa-solid fa-chart-line"></i> Dashboard
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'admin_parcels' ? 'active' }}">
                    <a href="{{ path('admin_parcels') }}">
                        <i class="fa-solid fa-box"></i> Colis
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'admin_invoices' ? 'active' }}">
                    <a href="{{ path('admin_invoices') }}">
                        <i class="fa-solid fa-file-invoice"></i> Invoices
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'admin_vehicles' ? 'active' }}">
                    <a href="{{ path('admin_vehicles') }}">
                        <i class="fa-solid fa-truck"></i> Vehicles
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'admin_forum' ? 'active' }}">
                    <a href="{{ path('admin_forum') }}">
                        <i class="fa-solid fa-comments"></i> Forum
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'admin_incidents' ? 'active' }}">
                    <a href="{{ path('admin_incidents') }}">
                        <i class="fa-solid fa-triangle-exclamation"></i> Incidents
                    </a>
                </li>
                <li class="{{ app.request.get('_route') starts with 'app_notifications' ? 'active' }}">
                    <a href="{{ path('app_notifications_index') }}">
                        <i class="fa-solid fa-bell"></i> Notifications
                    </a>
                </li>
            </ul>
        </aside>

        {# MAIN CONTENT #}
        <main class="main">
            {% block body %}{% endblock %}
        </main>
    </div>

    {% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filterButtons = document.querySelectorAll('.filter-btn');
            const tableContainer = document.getElementById('parcels-table-container');
            const baseUrl = '{{ path('admin_parcels') }}';

            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const status = btn.dataset.status;

                    // UI : bouton actif
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Loader
                    tableContainer.innerHTML = '<p style="text-align:center;padding:30px">Loading...</p>';

                    // RequÃªte AJAX
                    fetch(`${baseUrl}?status=${status}`, {
                        headers: { 'X-Requested-With': 'XMLHttpRequest' }
                    })
                    .then(res => {
                        if (!res.ok) throw new Error('Network error');
                        return res.text();
                    })
                    .then(html => {
                        tableContainer.innerHTML = html;
                    })
                    .catch(() => {
                        tableContainer.innerHTML = '<p style="color:red;text-align:center">Error loading data.</p>';
                    });
                });
            });
        });
    </script>
{% endblock %}
</body>
</html>